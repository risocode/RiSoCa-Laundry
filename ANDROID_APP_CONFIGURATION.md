# Android App Configuration for TWA

This guide explains how to configure your Android app (generated by PWA Builder) to enable credential sharing with your website.

## ‚úÖ Website Configuration (Already Done)

Your website is now configured with the correct `assetlinks.json` file at:
- `https://rkrlaundry.com/.well-known/assetlinks.json`

The file includes:
- ‚úÖ App deep linking (`common.handle_all_urls`)
- ‚úÖ Credential sharing from website to app (`common.get_login_creds` ‚Üí android_app)
- ‚úÖ Credential sharing from app to website (`common.get_login_creds` ‚Üí web)

---

## üì± Android App Configuration

You need to configure your Android app to reference the website's assetlinks.json file.

### Step 1: Update AndroidManifest.xml

Open your Android app's `AndroidManifest.xml` file and add the following inside the `<application>` tag:

```xml
<application>
  <!-- ... other application configuration ... -->
  
  <!-- Add this meta-data tag -->
  <meta-data 
    android:name="asset_statements" 
    android:resource="@string/asset_statements" />
  
  <!-- ... rest of application configuration ... -->
</application>
```

**Location:** `app/src/main/AndroidManifest.xml`

### Step 2: Update strings.xml

Open your Android app's `strings.xml` file and add the `asset_statements` string resource:

```xml
<resources>
  <!-- ... other strings ... -->
  
  <!-- Add this string resource -->
  <string name="asset_statements" translatable="false">
[{
  \"include\": \"https://rkrlaundry.com/.well-known/assetlinks.json\"
}]
  </string>
  
  <!-- ... rest of strings ... -->
</resources>
```

**Location:** `app/src/main/res/values/strings.xml`

**Important Notes:**
- The `translatable="false"` attribute is required
- The JSON must be properly escaped (use `\"` for quotes)
- The URL must match exactly: `https://rkrlaundry.com/.well-known/assetlinks.json`

### Step 3: Verify Configuration

After making these changes:

1. **Build your app:**
   ```bash
   ./gradlew assembleRelease
   ```

2. **Test the configuration:**
   - Use Google's Digital Asset Links validator: https://developers.google.com/digital-asset-links/tools/generator
   - Enter your website URL and package name
   - Click "Test statement" to verify both directions work

3. **Install and test:**
   - Install the APK on a device
   - Verify that credential sharing works between the app and website

---

## üîç Verification Checklist

- [ ] `assetlinks.json` is accessible at `https://rkrlaundry.com/.well-known/assetlinks.json`
- [ ] `AndroidManifest.xml` includes the `asset_statements` meta-data
- [ ] `strings.xml` includes the `asset_statements` string with correct URL
- [ ] App builds successfully
- [ ] Google's validator confirms both directions work
- [ ] Credential sharing works in the installed app

---

## üìö Additional Resources

- [Digital Asset Links Documentation](https://developers.google.com/digital-asset-links/v1/getting-started)
- [Credential Sharing Guide](https://developers.google.com/identity/smart-lock-passwords/android/associate-apps-and-sites)
- [PWA Builder Documentation](https://docs.pwabuilder.com/)

---

## üêõ Troubleshooting

### Issue: "No credential sharing permission was granted"

**Solution:**
1. Verify the `asset_statements` string in `strings.xml` is correct
2. Ensure the URL in the string matches exactly: `https://rkrlaundry.com/.well-known/assetlinks.json`
3. Check that the JSON is properly escaped
4. Rebuild and reinstall the app

### Issue: "ERROR_CODE_REDIRECT"

**Solution:**
1. Verify the website's `assetlinks.json` is accessible
2. Check that the file returns HTTP 200 (not 301/302 redirect)
3. Ensure the `Content-Type` header is `application/json`
4. Test the URL directly in a browser

### Issue: App builds but credential sharing doesn't work

**Solution:**
1. Verify both website and app configurations are correct
2. Ensure you're using the release build (not debug)
3. Check that the SHA-256 fingerprint matches in both places
4. Wait a few minutes after deployment for changes to propagate

---

## ‚úÖ Summary

Once you've completed these steps:

1. **Website side:** ‚úÖ Already configured
2. **Android app side:** Add the meta-data and string resource as shown above
3. **Deploy:** Build and publish your app
4. **Test:** Use Google's validator to verify everything works

Your TWA will then support:
- ‚úÖ App deep linking
- ‚úÖ Credential sharing (bidirectional)
- ‚úÖ Seamless sign-in experience

